import{a as J,b as K}from"./chunk-ZWP7YXIA.js";import{c as Y,i as U,j as X}from"./chunk-W2TXYWHH.js";import{b as oe}from"./chunk-K7NKUSYG.js";import{a as W}from"./chunk-LPJYTGRJ.js";import{D as B,F as H,c as D,g as L,h as z,l as $,m as R,o as A,p as q,u as V,v as O,w as Q,y as G}from"./chunk-TLGWP4EV.js";import"./chunk-C6TFH6MB.js";import"./chunk-XP4VTDCW.js";import{$ as k,F as j}from"./chunk-6H3AXDJP.js";import"./chunk-JJVHQNWG.js";import{Ga as C,Ha as b,Sa as _,T as h,Ub as I,bb as a,cb as o,db as u,f as ne,ic as T,jb as d,oa as M,pb as y,qb as x,rb as P,uc as E,wa as S,wb as l,xa as m,xb as N,yc as F}from"./chunk-UXO2XUWN.js";var Z=(()=>{class r{static{this.\u0275fac=function(i){return new(i||r)}}static{this.\u0275cmp=C({type:r,selectors:[["app-patients"]],decls:1,vars:0,template:function(i,t){i&1&&u(0,"router-outlet")},dependencies:[E],encapsulation:2})}}return r})();var ee=ne(oe());var ae=["urgentTemplate"],se=["parrentIdTemplate"],te=(()=>{class r{constructor(e,i,t,n,s,f){this.filterService=e,this.dialog=i,this.patientsService=t,this.requestsService=n,this.notificationService=s,this.formBuilder=f,this.patients=M([]),this.isMobile=window.innerWidth<768,this.pageSize=0,this.total=0,this.pagesCount=1,this.pageNumber=1,this.allServiceType=[],this.allServiceColor=[],this.allRequestStatuses=[],this.columns=[],this.isServerPagination=!0,this.filteredDoctor=I(()=>{let p=this.filterService.searchField().toLowerCase(),v=this.filterService.statusField(),c=this.filterService.orderField();return this.patients().filter(g=>g.doctor_name.toLowerCase().includes(p)||g.patient_name.toLowerCase().includes(p)||g.laboratory_name.toLowerCase().includes(p)).sort((g,me)=>{let re=!c||c==="1";return 0})}),this.String=String}ngOnInit(){this.columns=[{header:"\u06A9\u062F",field:"id"},{header:"\u0646\u0627\u0645 \u0648 \u0646\u0627\u0645 \u062E\u0627\u0646\u0648\u0627\u062F\u06A9\u06CC",field:"full_name",width:"150px"},{header:"\u06A9\u062F \u0645\u0644\u06CC",field:"national_code"},{header:"\u0645\u0648\u0628\u0627\u06CC\u0644",field:"mobile"}],this.filterPatientForm=this.formBuilder.group({id:[""],full_name:[""],mobile:[""],national_code:[""],limit:[10],page:[1]}),this.getPatients()}addPatient(){this.dialog.open(K,{width:this.isMobile?"100vw":"auto",maxWidth:"100vw",panelClass:this.isMobile?"full-screen-dialog":""}).afterClosed().subscribe(e=>{e&&this.getPatients()})}getPatients(){this.patientsService.getPatients(this.filterPatientForm.value).subscribe({next:e=>{this.patients.set(e.response.rows),this.pageSize=e.response.limit,this.total=e.response.total,this.pagesCount=Math.floor(this.total/this.pageSize),this.total%this.pageSize>0&&this.pagesCount++},error:e=>{this.notificationService.openSnackbar(e.error.message,"error")}})}onPageSizeChange(e){this.filterPatientForm.patchValue({limit:e}),this.getPatients()}get pageIndexes(){return Array.from({length:this.pagesCount},(e,i)=>i)}getOrderOptions(){this.requestsService.getOrderOptions().subscribe({next:e=>{this.allServiceColor=e.response.service_color,this.allServiceType=e.response.service_types,this.allRequestStatuses=e.response.order_statuses},error:e=>{this.notificationService.openSnackbar(e.error.message,"error")}})}changesPage(e){if(e.state==="prev"){if(this.pageNumber<=1)return;this.pageNumber--}else if(e.state==="next"){if(this.pageNumber>=this.pageIndexes.length)return;this.pageNumber++}else if(e.state==="pageNumber"){if(this.pageNumber===e.page)return;this.pageNumber=e.page}this.filterPatientForm.patchValue({page:this.pageNumber}),this.getPatients()}resetSearchForm(){this.filterPatientForm.reset({full_name:[""],mobile:[""],national_code:[""],limit:10,page:1}),this.getPatients()}parseToJalali(e){let i=ee.default.utc(e).local();if(!i.isValid())return{date:"",time:""};let t=i.locale("fa").format("jYYYY/jMM/jDD HH:mm"),[n,s]=t.split(" ");return{date:n,time:s}}formatDateToCustom(e,i="full"){let t=new Date(e),n=t.getFullYear(),s=String(t.getMonth()+1).padStart(2,"0"),f=String(t.getDate()).padStart(2,"0"),p=String(t.getHours()).padStart(2,"0"),v=String(t.getMinutes()).padStart(2,"0"),c=String(t.getSeconds()).padStart(2,"0");return i=="date"?`${n}-${s}-${f}`:i=="time"?`${p}:${v}:${c}`:i=="full"?`${n}-${s}-${f} ${p}:${v}:${c}`:""}static{this.\u0275fac=function(i){return new(i||r)(m(X),m(Y),m(J),m(W),m(k),m(V))}}static{this.\u0275cmp=C({type:r,selectors:[["app-patients-list"]],viewQuery:function(i,t){if(i&1&&(y(ae,7),y(se,7)),i&2){let n;x(n=P())&&(t.urgentTemplate=n.first),x(n=P())&&(t.parrentIdTemplate=n.first)}},decls:33,vars:9,consts:[[1,"item-center","mb-4","flex","flex-col","md:flex-row","md:justify-between"],[1,"inline-block","w-full","px-2"],[1,"text-foreground","font-semibold"],[1,"text-muted-foreground","space-x-1","text-xs","font-medium"],["href","",1,"hover:text-primary"],[1,"text-foreground"],["dir","ltr",1,"mt-4","grid","w-full","grid-cols-1","gap-4","md:flex","md:flex-row"],[1,"bg-primary","text-primary-foreground","flex-none","cursor-pointer","rounded-md","px-4","py-2.5","text-xs","font-semibold","md:mx-2",3,"click"],[1,"bg-background","bg-background","grid","grid-cols-2","gap-4","py-4","pr-4","md:grid-cols-6",3,"formGroup"],["appearance","outline",1,"inputs"],["matInput","","formControlName","id","type","number"],["matInput","","formControlName","full_name","type","text"],["matInput","","formControlName","national_code","type","number"],["matInput","","formControlName","mobile","type","number"],[1,"text-2xl","text-white"],[1,"fa-solid","fa-search","bg-primary","mx-2","cursor-pointer","rounded-xl","p-[6px]",3,"click"],[1,"fa-solid","fa-xmark","bg-primary","w-[35px]","cursor-pointer","rounded-xl","p-[6px]","pr-[9px]",3,"click"],[3,"pageChange","pageSizeChange","columns","data","page","pageSize","total","isServerPagination","pageIndexes"]],template:function(i,t){i&1&&(a(0,"div",0)(1,"div",1)(2,"h3",2),l(3,"\u0644\u06CC\u0633\u062A \u0628\u06CC\u0645\u0627\u0631\u0627\u0646"),o(),a(4,"div",3)(5,"a",4),l(6,"\u062A\u0639\u062F\u0627\u062F \u06A9\u0644:"),o(),a(7,"span",5),l(8),o()()(),a(9,"div",6)(10,"button",7),d("click",function(){return t.addPatient()}),l(11," \u0627\u0641\u0632\u0648\u062F\u0646 \u0628\u06CC\u0645\u0627\u0631 "),o()()(),a(12,"form",8)(13,"mat-form-field",9)(14,"mat-label"),l(15,"\u06A9\u062F \u0628\u06CC\u0645\u0627\u0631"),o(),u(16,"input",10),o(),a(17,"mat-form-field",9)(18,"mat-label"),l(19,"\u0646\u0627\u0645 \u0648 \u0646\u0627\u0645 \u062E\u0627\u0646\u0648\u062F\u06AF\u06CC"),o(),u(20,"input",11),o(),a(21,"mat-form-field",9)(22,"mat-label"),l(23,"\u06A9\u062F\u0645\u0644\u06CC"),o(),u(24,"input",12),o(),a(25,"mat-form-field",9)(26,"mat-label"),l(27,"\u0645\u0648\u0628\u0627\u06CC\u0644"),o(),u(28,"input",13),o(),a(29,"div",14)(30,"i",15),d("click",function(){return t.getPatients()}),o(),a(31,"i",16),d("click",function(){return t.resetSearchForm()}),o()()(),a(32,"app-dynamic-table",17),d("pageChange",function(s){return t.changesPage(s)})("pageSizeChange",function(s){return t.onPageSizeChange(s)}),o()),i&2&&(S(8),N(t.total),S(4),_("formGroup",t.filterPatientForm),S(20),_("columns",t.columns)("data",t.patients())("page",t.pageNumber)("pageSize",t.pageSize)("total",t.total)("isServerPagination",!0)("pageIndexes",t.pageIndexes))},dependencies:[U,j,O,$,D,R,L,z,B,H,G,Q,A,q],encapsulation:2})}}return r})();var le=[{path:"",component:Z,children:[{path:"",component:te},{path:"**",redirectTo:"errors/404"}]}],ie=(()=>{class r{static{this.\u0275fac=function(i){return new(i||r)}}static{this.\u0275mod=b({type:r})}static{this.\u0275inj=h({imports:[F.forChild(le),F]})}}return r})();var ke=(()=>{class r{static{this.\u0275fac=function(i){return new(i||r)}}static{this.\u0275mod=b({type:r})}static{this.\u0275inj=h({imports:[T,ie]})}}return r})();export{ke as PatientsModule};
